{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"onChangeText\", \"value\", \"mask\"];\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nimport * as React from 'react';\nimport { TextInput } from 'react-native-paper';\nvar splitCharacters = ['-', '/', '.', '年', ' '];\n\nfunction detectCharacter(mask) {\n  var c = splitCharacters.find(function (ch) {\n    return mask.includes(ch);\n  });\n  return c || '';\n}\n\nfunction enhanceTextWithMask(text, mask, previousValue) {\n  var isBackSpace = previousValue.length > text.length;\n  var splitCharacter = detectCharacter(mask);\n  var maskParts = mask.split(splitCharacter);\n  var textParts = text.split(splitCharacter);\n  var finalString = [];\n\n  for (var maskPartIndex = 0; maskPartIndex < mask.length; maskPartIndex++) {\n    var partString = [];\n    var maskPart = maskParts[maskPartIndex];\n    var textPart = textParts[maskPartIndex];\n\n    if (!textPart) {\n      continue;\n    }\n\n    for (var maskDigitIndex = 0; maskDigitIndex < maskPart.length; maskDigitIndex++) {\n      var currentCharacter = textPart[maskDigitIndex];\n\n      if (isBackSpace && currentCharacter === undefined) {\n        continue;\n      }\n\n      var character = textPart[maskDigitIndex];\n\n      if (character !== undefined) {\n        partString.push(character);\n      }\n    }\n\n    finalString.push(partString.join(''));\n  }\n\n  var lastPart = finalString[finalString.length - 1];\n  var lastMaskPart = maskParts[finalString.length - 1];\n\n  if (finalString.length !== maskParts.length && lastPart && lastMaskPart && lastPart.length === lastMaskPart.length) {\n    return finalString.join(splitCharacter) + (isBackSpace ? '' : splitCharacter);\n  }\n\n  return finalString.join(splitCharacter);\n}\n\nfunction TextInputWithMask(_ref, ref) {\n  var onChangeText = _ref.onChangeText,\n      value = _ref.value,\n      mask = _ref.mask,\n      rest = _objectWithoutProperties(_ref, _excluded);\n\n  var _React$useState = React.useState(value || ''),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      controlledValue = _React$useState2[0],\n      setControlledValue = _React$useState2[1];\n\n  var onInnerChange = function onInnerChange(text) {\n    var enhancedText = enhanceTextWithMask(text, mask, controlledValue);\n    setControlledValue(enhancedText);\n\n    if (text.length === mask.length) {\n      onChangeText && onChangeText(text);\n    }\n  };\n\n  React.useEffect(function () {\n    setControlledValue(value || '');\n  }, [value]);\n  return React.createElement(TextInput, _extends({\n    ref: ref\n  }, rest, {\n    value: controlledValue,\n    onChangeText: onInnerChange\n  }));\n}\n\nexport default React.forwardRef(TextInputWithMask);","map":{"version":3,"sources":["TextInputMask.tsx"],"names":["splitCharacters","c","ch","mask","isBackSpace","previousValue","text","splitCharacter","detectCharacter","maskParts","textParts","finalString","maskPartIndex","partString","maskPart","textPart","maskDigitIndex","currentCharacter","character","lastPart","lastMaskPart","rest","React","value","onInnerChange","enhancedText","enhanceTextWithMask","setControlledValue","onChangeText","ref"],"mappings":"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","sourcesContent":["import * as React from 'react'\nimport { TextInput } from 'react-native-paper'\n\nconst splitCharacters = ['-', '/', '.', '年', ' ']\nfunction detectCharacter(mask: string): string {\n  const c = splitCharacters.find((ch) => mask.includes(ch))\n  return c || ''\n}\n\nfunction enhanceTextWithMask(\n  text: string,\n  mask: string,\n  previousValue: string\n): string {\n  const isBackSpace = previousValue.length > text.length\n  const splitCharacter = detectCharacter(mask)\n\n  const maskParts = mask.split(splitCharacter)\n  const textParts = text.split(splitCharacter)\n\n  let finalString: string[] = []\n  for (let maskPartIndex = 0; maskPartIndex < mask.length; maskPartIndex++) {\n    let partString: string[] = []\n\n    const maskPart = maskParts[maskPartIndex]\n    const textPart = textParts[maskPartIndex]\n    if (!textPart) {\n      continue\n    }\n\n    for (\n      let maskDigitIndex = 0;\n      maskDigitIndex < maskPart.length;\n      maskDigitIndex++\n    ) {\n      const currentCharacter = textPart[maskDigitIndex]\n\n      if (isBackSpace && currentCharacter === undefined) {\n        continue\n      }\n\n      const character = textPart[maskDigitIndex]\n\n      if (character !== undefined) {\n        partString.push(character)\n      }\n    }\n\n    finalString.push(partString.join(''))\n  }\n\n  const lastPart = finalString[finalString.length - 1]\n  const lastMaskPart = maskParts[finalString.length - 1]\n  if (\n    // if mask is completed\n    finalString.length !== maskParts.length &&\n    // or ...\n    lastPart &&\n    lastMaskPart &&\n    lastPart.length === lastMaskPart.length\n  ) {\n    return (\n      finalString.join(splitCharacter) + (isBackSpace ? '' : splitCharacter)\n    )\n  }\n  return finalString.join(splitCharacter)\n}\n\nfunction TextInputWithMask(\n  {\n    onChangeText,\n    value,\n    mask,\n    ...rest\n  }: React.ComponentProps<typeof TextInput> & { mask: string },\n  ref: any\n) {\n  const [controlledValue, setControlledValue] = React.useState<string>(\n    value || ''\n  )\n\n  const onInnerChange = (text: string) => {\n    const enhancedText = enhanceTextWithMask(text, mask, controlledValue)\n    setControlledValue(enhancedText)\n\n    if (text.length === mask.length) {\n      onChangeText && onChangeText(text)\n    }\n  }\n\n  React.useEffect(() => {\n    setControlledValue(value || '')\n  }, [value])\n\n  return (\n    <TextInput\n      ref={ref}\n      {...rest}\n      value={controlledValue}\n      onChangeText={onInnerChange}\n    />\n  )\n}\n\nexport default React.forwardRef(TextInputWithMask)\n"]},"metadata":{},"sourceType":"module"}